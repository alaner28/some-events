"use strict";const e=require("../common/vendor.js"),t=e.defineStore("user",{state:()=>({currentUser:null,defaultAvatars:"/static/OIP-C.jpg",meta:{isLoggedin:!1,tokenExpiresAt:0}}),getters:{displayName(e){var t;return(null==(t=e.currentUser)?void 0:t.username)||"未登录用户"},formattedJoinDate:e=>e.currentUser?new Date(e.currentUser.createdAt).toLocaleDateString("zh-CN"):"",getDefaltAvatar:e=>e.defaultAvatars},actions:{async initializeUser(){try{if(e.index.getStorageSync("token")){const e=await this.fetchUserProfile();this.setUser(e)}}catch(t){console.error("用户初始化失败:",t)}},async fetchUserProfile(){const t=await e.index.request({url:"",method:"GET"});if(200!==t.statusCode)throw new Error("获取用户信息失败");return{...t.data,createdAt:new Date(t.data.createdAt),lastLogin:new Date(t.data.lastLogin)}},setUser(t){this.currentUser={...t,avatar:t.avatar||this.getDefaltAvatar},this.meta.isLoggedIn=!0,e.index.setStorageSync("userData",JSON.stringify(t))},updateUserProfile(t){this.currentUser&&(this.currentUser={...this.currentUser,...t},e.index.setStorageSync("userData",JSON.stringify(this.currentUser)))},clearUser(){this.currentUser=null,this.meta.isLoggedIn=!1,e.index.removeStorageSync("token"),e.index.removeStorageSync("userData")}}});exports.useUserStore=t;
